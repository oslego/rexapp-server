<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
    
    <script type="text/javascript">
    var rates = [{ id: 'bcr', currency: 'EUR', buy: '4.4700', sell: '4.6000' },
    { id: 'bcr', currency: 'USD', buy: '3.4300', sell: '3.5700' },
    { id: 'bcr', currency: 'GBP', buy: '5.5600', sell: '5.7400' },
    { id: 'bcr', currency: 'CHF', buy: '3.6920', sell: '3.8220' },
    { id: 'bcr', currency: 'CAD', buy: '3.4230', sell: '3.6350' },
    { id: 'bcr', currency: 'AUD', buy: '3.4430', sell: '3.6860' },
    { id: 'bcr', currency: 'NOK', buy: '0.5910', sell: '0.6300' },
    { id: 'bcr', currency: 'DKK', buy: '0.5890', sell: '0.6280' },
    { id: 'bcr', currency: 'SEK', buy: '0.5080', sell: '0.5430' },
    { id: 'bcr', currency: 'JPY', buy: '0.0420', sell: '0.0460' },
    { id: 'bcr', currency: 'HUF', buy: '0.0153', sell: '0.0165' },
    { id: 'bcr', currency: 'PLN', buy: '1.0690', sell: '1.1510' },
    { id: 'bcr', currency: 'CZK', buy: '0.1750', sell: '0.1890' },
    { id: 'bcr', currency: 'RUB', buy: '0.1080', sell: '0.1170' },
    { id: 'bcr', currency: 'BGN', buy: '2.2350', sell: '2.4040' },
    { id: 'piraeus', currency: 'EUR', buy: '4.4860', sell: '4.5760' },
    { id: 'piraeus', currency: 'USD', buy: '3.4590', sell: '3.5500' },
    { id: 'piraeus', currency: 'CHF', buy: '3.6730', sell: '3.7990' },
    { id: 'piraeus', currency: 'GBP', buy: '5.5800', sell: '5.7040' },
    { id: 'piraeus', currency: 'HUF', buy: '0.0154', sell: '0.0163' },
    { id: 'unicredit',
      currency: 'EUR',
      buy: '4.4900',
      sell: '4.6100' },
    { id: 'unicredit',
      currency: 'USD',
      buy: '3.4472',
      sell: '3.5791' },
    { id: 'unicredit',
      currency: 'GBP',
      buy: '5.5544',
      sell: '5.7683' },
    { id: 'unicredit',
      currency: 'CHF',
      buy: '3.6778',
      sell: '3.8289' },
    { id: 'unicredit',
      currency: 'JPY',
      buy: '0.0438',
      sell: '0.0456' },
    { id: 'unicredit',
      currency: 'NOK',
      buy: '0.5856',
      sell: '0.6397' },
    { id: 'unicredit',
      currency: 'SEK',
      buy: '0.5031',
      sell: '0.5531' },
    { id: 'unicredit',
      currency: 'DKK',
      buy: '0.5844',
      sell: '0.6362' },
    { id: 'unicredit',
      currency: 'AUD',
      buy: '3.5177',
      sell: '3.6664' },
    { id: 'unicredit',
      currency: 'CAD',
      buy: '3.4913',
      sell: '3.6384' },
    { id: 'unicredit',
      currency: 'HUF',
      buy: '0.0153',
      sell: '0.0166' },
    { id: 'unicredit',
      currency: 'EUR',
      buy: '4.4800',
      sell: '4.6200' },
    { id: 'unicredit',
      currency: 'USD',
      buy: '3.4400',
      sell: '3.5800' },
    { id: 'unicredit',
      currency: 'GBP',
      buy: '5.5300',
      sell: '5.7800' },
    { id: 'unicredit',
      currency: 'CHF',
      buy: '3.6700',
      sell: '3.8300' },
    { id: 'unicredit',
      currency: 'JPY',
      buy: '0.0437',
      sell: '0.0457' },
    { id: 'unicredit',
      currency: 'NOK',
      buy: '0.5800',
      sell: '0.6500' },
    { id: 'unicredit',
      currency: 'SEK',
      buy: '0.5000',
      sell: '0.5600' },
    { id: 'unicredit',
      currency: 'DKK',
      buy: '0.5800',
      sell: '0.6400' },
    { id: 'unicredit',
      currency: 'AUD',
      buy: '3.5100',
      sell: '3.6700' },
    { id: 'unicredit',
      currency: 'CAD',
      buy: '3.4800',
      sell: '3.6400' },
    { id: 'unicredit',
      currency: 'HUF',
      buy: '0.0152',
      sell: '0.0167' },
    { id: 'procredit',
      currency: 'USD',
      buy: '3.4306',
      sell: '3.5766' },
    { id: 'procredit',
      currency: 'EUR',
      buy: '4.5049',
      sell: '4.5929' },
    { id: 'cec', currency: 'GBP', buy: '5.6000', sell: '5.7200' },
    { id: 'cec', currency: 'EUR', buy: '4.5100', sell: '4.5700' },
    { id: 'cec', currency: 'USD', buy: '3.4600', sell: '3.5600' },
    { id: 'cec', currency: 'CHF', buy: '3.6800', sell: '3.8000' },
    { id: 'brd', currency: 'EUR', buy: '4.4600', sell: '4.6100' },
    { id: 'brd', currency: 'USD', buy: '3.4370', sell: '3.5780' },
    { id: 'brd', currency: 'SEK', buy: '0.5090', sell: '0.5380' },
    { id: 'brd', currency: 'DKK', buy: '0.5890', sell: '0.6220' },
    { id: 'brd', currency: 'NOK', buy: '0.5900', sell: '0.6230' },
    { id: 'brd', currency: 'CAD', buy: '3.4800', sell: '3.6520' },
    { id: 'brd', currency: 'AUD', buy: '3.4930', sell: '3.6850' },
    { id: 'brd', currency: 'JPY', buy: '0.0417', sell: '0.0465' },
    { id: 'brd', currency: 'CZK', buy: '0.1720', sell: '0.1890' },
    { id: 'brd', currency: 'PLN', buy: '1.0590', sell: '1.1580' },
    { id: 'brd', currency: 'HUF', buy: '0.0148', sell: '0.0165' },
    { id: 'volksbank',
      currency: 'USD',
      buy: '3.4290',
      sell: '3.5850' },
    { id: 'volksbank',
      currency: 'GBP',
      buy: '5.5370',
      sell: '5.7580' },
    { id: 'volksbank',
      currency: 'CHF',
      buy: '3.6640',
      sell: '3.8200' },
    { id: 'volksbank',
      currency: 'HUF',
      buy: '0.0133',
      sell: '0.0165' },
    { id: 'volksbank',
      currency: 'EUR',
      buy: '4.4630',
      sell: '4.6070' },
    { id: 'br', currency: 'EUR', buy: '4.5258', sell: '4.5828' },
    { id: 'br', currency: 'USD', buy: '3.4785', sell: '3.5355' },
    { id: 'br', currency: 'GBP', buy: '5.5871', sell: '5.7451' },
    { id: 'br', currency: 'CHF', buy: '3.7077', sell: '3.7877' },
    { id: 'alpha', currency: 'CHF', buy: '3.6377', sell: '3.8708' },
    { id: 'alpha', currency: 'EUR', buy: '4.4800', sell: '4.6200' },
    { id: 'alpha', currency: 'GBP', buy: '5.4956', sell: '5.8267' },
    { id: 'alpha', currency: 'USD', buy: '3.4143', sell: '3.6144' },
    { id: 'raiffeisen',
      currency: 'EUR',
      buy: '4.4600',
      sell: '4.5900' },
    { id: 'raiffeisen',
      currency: 'USD',
      buy: '3.4350',
      sell: '3.5700' },
    { id: 'raiffeisen',
      currency: 'GBP',
      buy: '5.5300',
      sell: '5.7400' },
    { id: 'raiffeisen',
      currency: 'CHF',
      buy: '3.6650',
      sell: '3.8100' },
    { id: 'raiffeisen',
      currency: 'AUD',
      buy: '3.5100',
      sell: '3.6500' },
    { id: 'raiffeisen',
      currency: 'CAD',
      buy: '3.4800',
      sell: '3.6150' },
    { id: 'raiffeisen',
      currency: 'DKK',
      buy: '0.5930',
      sell: '0.6200' },
    { id: 'raiffeisen',
      currency: 'JPY',
      buy: '0.0437',
      sell: '0.0453' },
    { id: 'raiffeisen',
      currency: 'NOK',
      buy: '0.5950',
      sell: '0.6230' },
    { id: 'raiffeisen',
      currency: 'SEK',
      buy: '0.5110',
      sell: '0.5370' }]
    
    </script>
    <script type="text/javascript">
    
    function buildResponse(rates){
        var resp = {
            updated_on: +new Date,
            rates: {},
            sources: {}
        }

        // create new object
        rates.forEach(function(rate, index){
            var rates = resp.rates,
                control = getControl(rate)

            if (!rates[item.currency]){
                rates[item.currency] = []
            }

            rate.updated_on = getUpdatedOn(rate, control)

            rates[rate.currency].push(rate)
        }) 
        
        return resp
    }
    
    function getControl(rate){
        var lastRates
        
        lastRates[rate.currency].filter(function(item){
            return item.id === rate.id
        }).pop()
    }
    
    function getUpdatedOn(rate, control){
        return ( equals(rate.sell, control.sell) && equals(rate.buy, control.buy) ) 
            ? control.updated_on
            : +new Date
    }

    function equals(a, b){
        return a === b
    }

    console.dir(buildResponse(rates))
    
    </script>
</body>
</html>